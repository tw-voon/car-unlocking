{"version":3,"sources":["app.module.js","core/core.module.js","storage/storage.module.js","core/core.run.js","storage/storage.service.js"],"names":["angular","module","config","$compileProvider","debugInfoEnabled","run","$http","$timeout","appStorageService","$q","$cordovaFile","$cordovaSplashscreen","$cordovaAppVersion","$cordovaDialogs","$window","onDeviceReady","console","log","load","getObject","undefined","lang","getVersionNumber","then","version","appVersion","checkversion","set","get","domain","Math","random","timeout","success","data","build","appV","split","dataV","runupdate","ionic","Platform","isIOS","alert","cordova","plugins","market","open","confirm","buttonIndex","navigator","app","exitApp","$","show","init","error","retryCheck","intervalcheck","Date","now","css","window","location","reload","checkinterval","hide","update","nativeURL","url","js","promises","writepromises","createDir","file","dataDirectory","res","push","forEach","d","pop","all","results","i","length","writeFile","setObject","resultcss","resultjs","resultimg","allPromise","readAsText","append","eval","setTimeout","document","addEventListener","$inject","key","localStorage","val","JSON","stringify","parse","setToObject","subkey","getToObject","removeItem","service","factory"],"mappings":"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","file":"load-debug.min.js","sourcesContent":["angular\n.module('app', [\n\t'app.core',\n\t'app.storage'\n]);","angular\n    .module('app.core', [\n        'app.core.run'\n    ])\n    .config(['$compileProvider', function ($compileProvider) {\n  // disable debug info\n  $compileProvider.debugInfoEnabled(false);\n}]);","angular\n    .module('app.storage', [\n        'app.storage.service'\n    ]);","angular\n.module('app.core.run', ['ngCordova'])\n.run(run);\n\nfunction run($http, $timeout, appStorageService, $q, $cordovaFile, $cordovaSplashscreen, $cordovaAppVersion, $cordovaDialogs, $window) {\n\tvar load, lang, appVersion, retryCheck = 0, checkinterval = 300000;\n\n\tvar domain = \"http://192.168.112.2/CarLockApps/server\";\n\n\tdocument.addEventListener(\"deviceready\", onDeviceReady, false);\n\n\tfunction onDeviceReady() {\n\t\tconsole.log(\"ready\");\n\t\tload = appStorageService.getObject(\"load\");\n\t\tconsole.log(load);\n\n\t\tif(lang === undefined){\n\t\t\tlang = 'en';\n\t\t}\n\n\t\t$cordovaAppVersion.getVersionNumber().then(function (version) {\n\t\t\tappVersion = version;\n\t\t\tconsole.log(\"App Version:\"+appVersion);\n\t\t\tcheckversion();\n\t\t\tappStorageService.set(\"appVersion\",appVersion);\n\t\t});\n\t}\n\n\tfunction checkversion(){\n\t\t$http.get(domain+\"/version.json?r=\"+Math.random(),{timeout: 5000}).success(function(data){\n\t\t\tconsole.log(\"checkversion\");\n\t\t\tif(load.build!=data.build){\n\t\t\t\tvar appV = appVersion.split(\".\");\n\t\t\t\tvar dataV = data.version.split(\".\");\n\t\t\t\tif(appV[0]>dataV[0]){\n\t\t\t\t\trunupdate(data);\n\t\t\t\t}else if(appV[0]==dataV[0] && appV[1]>dataV[1] ){\n\t\t\t\t\trunupdate(data);\n\t\t\t\t}else if(appV[0]==dataV[0] && appV[1]==dataV[1] && appV[2]>=dataV[2] ){\n\t\t\t\t\trunupdate(data);\n\t\t\t\t}else{\n\t\t\t\t\t// Newer app version needed!!!\n\t\t\t\t\tif(ionic.Platform.isIOS()){\n\t\t\t\t\t\t$cordovaDialogs.alert('You need to update your app in order to continue using.', 'Alert', 'Upgrade')\n\t\t\t\t\t\t.then(function() {\n\t\t\t\t\t\t\tcordova.plugins.market.open('net.lucky8888.app');\n\t\t\t\t\t\t});\n\t\t\t\t\t}else{\n\t\t\t\t\t\t$cordovaDialogs.confirm('You need to update your app in order to continue using.', 'Alert', ['Exit','Upgrade'])\n\t\t\t\t\t\t.then(function(buttonIndex) {\n\t\t\t\t\t\t\t// no button = 0, 'OK' = 1, 'Cancel' = 2\n\t\t\t\t\t\t\t// btnIndex = buttonIndex;\n\t\t\t\t\t\t\tconsole.log(buttonIndex);\n\t\t\t\t\t\t\tif(buttonIndex==2){\n\t\t\t\t\t\t\t\t// upgrade\n\t\t\t\t\t\t\t\t// alert(\"Perform upgrading...\");\n\t\t\t\t\t\t\t\tcordova.plugins.market.open('net.lucky8888.app');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tnavigator.app.exitApp();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\t$(\"#updatepage .loading\").show();\n\t\t\t\tinit();\n\t\t\t}\n\n\t\t}).error(function(){\n\n\t\t\tretryCheck = retryCheck+1;\n\t\t\tif(retryCheck<3){\n\t\t\t\tcheckversion();\n\t\t\t}else{\n\n\t\t\t\tif(ionic.Platform.isIOS()){\n\t\t\t\t\t$cordovaDialogs.alert('Fail to connect to server', 'Error', 'Retry')\n\t\t\t\t\t.then(function() {\n\t\t\t\t\t\tretryCheck = 0;\n\t\t\t\t\t\tcheckversion();\n\t\t\t\t\t});\n\t\t\t\t}else{\n\t\t\t\t\t$cordovaDialogs.confirm('Fail to connect to server', 'Error', ['Exit','Retry'])\n\t\t\t\t\t.then(function(buttonIndex) {\n\t\t\t\t\t\t// no button = 0, 'OK' = 1, 'Cancel' = 2\n\t\t\t\t\t\t// btnIndex = buttonIndex;\n\t\t\t\t\t\tconsole.log(buttonIndex);\n\t\t\t\t\t\tif(buttonIndex==2){\n\t\t\t\t\t\t\tretryCheck = 0;\n\t\t\t\t\t\t\tcheckversion();\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tnavigator.app.exitApp();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t});\n\t}\n\n\tfunction intervalcheck(){\n\t\tconsole.log('intervalcheck');\n\t\t$http.get(domain+\"/version.json?r=\"+Date.now(), {timeout: 5000}).success(function(data){\n\t\t\tif(load.build!=data.build){\n\t\t\t\t$('#updatepage').css('background-color','#fff');\n\t\t\t\twindow.location.reload(true);\n\t\t\t}else{\n\t\t\t\t$timeout(function(){ intervalcheck(); }, checkinterval);\n\t\t\t}\n\t\t}).error(function(){\n\t\t\t$timeout(function(){ intervalcheck(); }, checkinterval);\n\t\t});\n\t}\n\n\tfunction runupdate(data){\n\t\t$(\"#updatepage .outer\").show(0,'',function(){\n\t\t\t$cordovaSplashscreen.hide();\n\t\t\tupdate(data);\n\t\t});\n\t}\n\n\tfunction update(data){\n\t\tconsole.log(\"running update\");\n\t\tvar url = [data.css[0],data.js[0]];\n\t\tvar css = [];\n\t\tvar js = [];\n\n\t\tvar promises = [];\n\t\tvar writepromises = [];\n\n\t\tvar nativeURL;\n\n\t\tvar createDir = $cordovaFile.createDir(cordova.file.dataDirectory,\"load\",true).then(function(res){\n\t\t\tnativeURL = res.nativeURL;\n\t\t});\n\t\tpromises.push(createDir);\n\n\t\turl.forEach(function(d) {\n\t\t\tpromises.push($http.get(d).success(function(data){\n\t\t\t\t// console.log(\"fetch success\"+d);\n\t\t\t\t// console.log(\"File extension:\"+d.split('.').pop());\n\t\t\t\tif(d.split('.').pop() == \"css\"){\n\t\t\t\t\tcss.push(data);\n\t\t\t\t}else{\n\t\t\t\t\tjs.push(data);\n\t\t\t\t}\n\t\t\t}));\n\t\t});\n\n\t\t$q.all(promises).then(function(results){\n\t\t\tconsole.log(\"success........\");\n\n\t\t\tfor (var i=0; i<css.length;i++){\n\t\t\t\tcss[i]='<style type=\"text/css\">'+css[i]+'</style>';\n\n\t\t\t\twritepromises.push($cordovaFile.writeFile(cordova.file.dataDirectory,\"css\"+i+\".dat\",css[i], true));\n\t\t\t}\n\n\t\t\tfor (var i=0; i<js.length;i++){\n\t\t\t\twritepromises.push($cordovaFile.writeFile(cordova.file.dataDirectory,\"js\"+i+\".dat\",js[i], true));\n\t\t\t}\n\n\t\t\tload = data;\n\t\t\tappStorageService.setObject(\"load\",data);\n\n\t\t\t$q.all(writepromises).then(function(results){\n\t\t\t\tinit();\n\t\t\t});\n\n\t\t\t// angular.bootstrap(document, ['ts']);\n\t\t},function(results){\n\t\t\tconsole.log(\"download update fail, retrying...\");\n\t\t\tconsole.log(results);\n\t\t\t// alert(\"fail\");\n\t\t\tupdate(data);\n\t\t});\n\t}\n\n\tfunction init(){\n\t\tvar resultcss = [];\n\t\tvar resultjs = [];\n\t\tvar resultimg = [];\n\t\tvar allPromise = [];\n\n\t\tconsole.log(\"running init\");\n\n\t\tfor (var i=0; i<load.css.length;i++){\n\t\t\tconsole.log(\"read css file\");\n\t\t\tresultcss.push($cordovaFile.readAsText(cordova.file.dataDirectory,\"css\"+i+\".dat\"));\n\t\t}\n\n\t\tfor (var i=0; i<load.js.length;i++){\n\t\t\tconsole.log(\"read js file\");\n\t\t\tresultjs.push($cordovaFile.readAsText(cordova.file.dataDirectory,\"js\"+i+\".dat\"));\n\t\t}\n\n\t\tallPromise.push(resultimg);\n\t\tallPromise.push(resultcss);\n\t\tallPromise.push(resultjs);\n\n\t\t$q.all(allPromise).then(function(results){\n\t\t\tconsole.log(\"all success\");\n\n\t\t\tfor (var i=0; i<resultcss.length;i++){\n\n\t\t\t\tresultcss[i].then(function(data){\n\t\t\t\t\t$(\"head\").append(data);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tfor (var i=0; i<resultjs.length;i++){\n\t\t\t\tresultjs[i].then(function(data){\n\t\t\t\t\teval(data);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsetTimeout(function(){ $cordovaSplashscreen.hide();},1500);\n\n\t\t}, function(results) {\n\t\t\tconsole.log(\"fail to read cached files\");\n\t\t\tconsole.log(results);\n\t\t\t// alert(\"Fail to read all files\");\n\t\t\tif(ionic.Platform.isIOS()){\n\t\t\t\t$cordovaDialogs.alert('Fail to read files', 'Error', 'OK')\n\t\t\t\t.then(function() {\n\t\t\t\t\t// navigator.app.exitApp();\n\t\t\t\t});\n\t\t\t}else{\n\t\t\t\t$cordovaDialogs.alert('Fail to read files', 'Error', 'Exit App')\n\t\t\t\t.then(function() {\n\t\t\t\t\tnavigator.app.exitApp();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tsetTimeout(function(){ $(\"#updatepage .outer\").hide(); intervalcheck(); }, 5000);\n\t}\n\n}\n\n","angular\n    .module('app.storage.service', [])\n    .factory('appStorageService', appStorageService);\n\nfunction appStorageService($window) {\n    console.log('app.storage.service');\n    var service = {\n        get: get,\n        set: set,\n        setObject: setObject,\n        getObject: getObject,\n        setToObject: setToObject,\n        getToObject: getToObject,\n        removeItem: removeItem\n    };\n\n    return service;\n    /////////////////////\n\n    function get(key) {\n        return $window.localStorage[key];\n    }\n\n    function set(key, val) {\n        $window.localStorage[key] = val;\n    }\n\n    function setObject(key, val) {\n        $window.localStorage[key] = JSON.stringify(val);\n    }\n\n    function getObject(key) {\n        return JSON.parse($window.localStorage[key] || '{}');\n    }\n\n    function setToObject(key, subkey, val) {\n        // setToObject('userInfo', 'name', 'new name')\n\n        var data = getObject(key);\n        \n        data[subkey] = val;\n\n        setObject(key, data);\n    }\n\n    function getToObject(key, subkey) {\n        // setToObject('userInfo', 'name')\n\n        var data = getObject(key);\n        return data[subkey];\n\n    }\n\n    function removeItem(key){\n        $window.localStorage.removeItem(key);\n    }\n\n}"],"sourceRoot":"/source/"}