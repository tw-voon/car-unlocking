(function(){"use strict";angular.module("app",["app.core","app.storage"]);
angular.module("app.core",["app.core.run"]).config(["$compileProvider",function(o){o.debugInfoEnabled(!1)}]);
angular.module("app.storage",["app.storage.service"]);
!function(){"use strict";function run($http,$timeout,appStorageService,$q,$cordovaFile,$cordovaSplashscreen,$cordovaAppVersion,$cordovaDialogs,$window){function onDeviceReady(){console.log("ready"),load=appStorageService.getObject("load"),console.log(load),void 0===lang&&(lang="en"),$cordovaAppVersion.getVersionNumber().then(function(e){appVersion=e,console.log("App Version:"+appVersion),checkversion(),appStorageService.set("appVersion",appVersion)})}function checkversion(){$http.get(domain+"/version.json?r="+Math.random(),{timeout:5e3}).success(function(e){if(console.log("checkversion"),load.build!=e.build){var o=appVersion.split("."),t=e.version.split(".");o[0]>t[0]?runupdate(e):o[0]==t[0]&&o[1]>t[1]?runupdate(e):o[0]==t[0]&&o[1]==t[1]&&o[2]>=t[2]?runupdate(e):ionic.Platform.isIOS()?$cordovaDialogs.alert("You need to update your app in order to continue using.","Alert","Upgrade").then(function(){cordova.plugins.market.open("net.lucky8888.app")}):$cordovaDialogs.confirm("You need to update your app in order to continue using.","Alert",["Exit","Upgrade"]).then(function(e){console.log(e),2==e&&cordova.plugins.market.open("net.lucky8888.app"),navigator.app.exitApp()})}else $("#updatepage .loading").show(),init()}).error(function(){retryCheck+=1,3>retryCheck?checkversion():ionic.Platform.isIOS()?$cordovaDialogs.alert("Fail to connect to server","Error","Retry").then(function(){retryCheck=0,checkversion()}):$cordovaDialogs.confirm("Fail to connect to server","Error",["Exit","Retry"]).then(function(e){console.log(e),2==e?(retryCheck=0,checkversion()):navigator.app.exitApp()})})}function intervalcheck(){console.log("intervalcheck"),$http.get(domain+"/version.json?r="+Date.now(),{timeout:5e3}).success(function(e){load.build!=e.build?($("#updatepage").css("background-color","#fff"),window.location.reload(!0)):$timeout(function(){intervalcheck()},checkinterval)}).error(function(){$timeout(function(){intervalcheck()},checkinterval)})}function runupdate(e){$("#updatepage .outer").show(0,"",function(){$cordovaSplashscreen.hide(),update(e)})}function update(e){console.log("running update");var o,t=[e.css[0],e.js[0]],r=[],n=[],i=[],a=[],c=$cordovaFile.createDir(cordova.file.dataDirectory,"load",!0).then(function(e){o=e.nativeURL});i.push(c),t.forEach(function(e){i.push($http.get(e).success(function(o){"css"==e.split(".").pop()?r.push(o):n.push(o)}))}),$q.all(i).then(function(o){console.log("success........");for(var t=0;t<r.length;t++)r[t]='<style type="text/css">'+r[t]+"</style>",a.push($cordovaFile.writeFile(cordova.file.dataDirectory,"css"+t+".dat",r[t],!0));for(var t=0;t<n.length;t++)a.push($cordovaFile.writeFile(cordova.file.dataDirectory,"js"+t+".dat",n[t],!0));load=e,appStorageService.setObject("load",e),$q.all(a).then(function(e){init()})},function(o){console.log("download update fail, retrying..."),console.log(o),update(e)})}function init(){var resultcss=[],resultjs=[],resultimg=[],allPromise=[];console.log("running init");for(var i=0;i<load.css.length;i++)console.log("read css file"),resultcss.push($cordovaFile.readAsText(cordova.file.dataDirectory,"css"+i+".dat"));for(var i=0;i<load.js.length;i++)console.log("read js file"),resultjs.push($cordovaFile.readAsText(cordova.file.dataDirectory,"js"+i+".dat"));allPromise.push(resultimg),allPromise.push(resultcss),allPromise.push(resultjs),$q.all(allPromise).then(function(results){console.log("all success");for(var i=0;i<resultcss.length;i++)resultcss[i].then(function(e){$("head").append(e)});for(var i=0;i<resultjs.length;i++)resultjs[i].then(function(data){eval(data)});setTimeout(function(){$cordovaSplashscreen.hide()},1500)},function(e){console.log("fail to read cached files"),console.log(e),ionic.Platform.isIOS()?$cordovaDialogs.alert("Fail to read files","Error","OK").then(function(){}):$cordovaDialogs.alert("Fail to read files","Error","Exit App").then(function(){navigator.app.exitApp()})}),setTimeout(function(){$("#updatepage .outer").hide(),intervalcheck()},5e3)}var load,lang,appVersion,retryCheck=0,checkinterval=3e5,domain="http://192.168.112.2/CarLockApps/server";document.addEventListener("deviceready",onDeviceReady,!1)}angular.module("app.core.run",["ngCordova"]).run(run),run.$inject=["$http","$timeout","appStorageService","$q","$cordovaFile","$cordovaSplashscreen","$cordovaAppVersion","$cordovaDialogs","$window"]}();
!function(){"use strict";function e(e){function t(t){return e.localStorage[t]}function o(t,o){e.localStorage[t]=o}function r(t,o){e.localStorage[t]=JSON.stringify(o)}function n(t){return JSON.parse(e.localStorage[t]||"{}")}function c(e,t,o){var c=n(e);c[t]=o,r(e,c)}function a(e,t){var o=n(e);return o[t]}function i(t){e.localStorage.removeItem(t)}console.log("app.storage.service");var u={get:t,set:o,setObject:r,getObject:n,setToObject:c,getToObject:a,removeItem:i};return u}angular.module("app.storage.service",[]).factory("appStorageService",e),e.$inject=["$window"]}();
})();
//# sourceMappingURL=load-debug.min.js.map